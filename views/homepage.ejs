<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/homepage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title><%= title %></title>
    <link rel="icon" href="<%= iconPath %>">
    <style>
        /* Cart count style */
        .cart-icon {
            position: relative;
        }
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff6b6b;
            color: white;
            font-size: 12px;
            font-weight: bold;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pet-card ,.product-card{
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease;
            height: 100%; /* Ensure consistent height */
        }

        .pet-card img ,.product-card img{
        width: 100%;
        height: 250px; /* Fixed height */
        object-fit: cover; /* Maintain aspect ratio */
        border-bottom: 1px solid #ddd;
        }

        .pet-card .price , .product-card .price{
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <header class="header" id="header">
        <nav id="navbar" class="navbar">
            <div class="nav-content">
                <div class="logo"><a href="#"><i class="fa fa-paw"></i> <%= siteName %></a></div>
                <div class="nav-icons">
                    <button onclick="window.location.href='/cart'" class="icon-btn cart-icon" id="cartIcon">
                        <i class="fa fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount" style="display: none;">0</span>
                    </button>
                    <button id="userButton" class="icon-btn"><i class="fa fa-user"></i></button>
                </div>
                <div class="search">
                    <input class="search-bar" type="text" placeholder=" Search pets, products or services">
                    <button class="search-btn"><i class="fa fa-search"></i></button>
                </div>
                <button class="hamburger" id="hamburger">
                    <i class="fa fa-bars"></i>
                </button>
                <ul class="nav-links">
                    <% navLinks.forEach(function(link) { %>
                        <% if (link.dropdown) { %>
                            <li class="dropdown">
                                <a href="<%= link.url %>" class="dropdown-toggle"><%= link.name %> <i class="fa fa-angle-down"></i></a>
                                <ul class="dropdown-menu">
                                    <% link.dropdownItems.forEach(function(item) { %>
                                        <li><a href="<%= item.url %>"><%= item.name %></a></li>
                                    <% }); %>
                                </ul>
                            </li>
                        <% } else { %>
                            <li><a href="<%= link.url %>"><%= link.name %></a></li>
                        <% } %>
                    <% }); %>
                </ul>
            </div>
        </nav>
    </header>
    <section class="hero">
        <div class="hero-content">
            <h1>Find your <span><%= heroTitle %></span></h1>
            <p><%= heroSubtitle %></p>
            <button class="adopt-btn" onclick="window.location.href='/pets'"><%= heroButtonText %></button>
        </div>
    </section>
    <section id="slideshow">
        <div class="slideshow-container">
            <% slides.forEach(function(slide, index) { %>
                <div class="slide fade">
                    <img src="<%= slide.image %>" alt="slide<%= index + 1 %>">
                    <div class="caption"><%= slide.caption %></div>
                </div>
            <% }); %>
            <button class="slideshow-btn prev" onclick="changeSlide(-1)">&#10094;</button>
            <button class="slideshow-btn next" onclick="changeSlide(1)">&#10095;</button>
        </div>
        <div class="dots">
        </div>
    </section>
    <hr>
    <section id="searchby-pet" class="searchby-pet">
        <div class="searchby-pet-content">
            <h1 class="section-title"><%= petSectionTitle %></h1>
            <div class="pet-grid">
                <% petCategories.forEach(function(pet) { %>
                    <div class="pet-card">
                        <img src="<%= pet.image %>" alt="<%= pet.name.toLowerCase() %>">
                        <h2 class="card-text"><%= pet.name %></h2>
                        <button class="card-button" onclick="window.location.href='/pets'"><%= exploreButtonText %></button>
                    </div>
                <% }); %>
            </div>
        </div>
    </section>
    <hr>
    <section class="feature-pets">
        <div class="feature-pets-content">
            <h1 class="section-title"><%= featuredPetsTitle %></h1>
            <div class="pet-grid">
                <% featuredPets.forEach(pet => { %>
                    <div class="pet-card">
                        <% 
                            if (pet.images && pet.images.length > 0)
                            {%>
                                    <img src="data:<%=pet.images[0].contentType%>;base64,<%=pet.images[0].data.toString('base64')%>" alt="<%=pet.name%>" class="pet-image">
                            <%}
                            else 
                            {%>
                                <p>No images available</p>    
                            <%}
                        %>
                        <p class="price"><strong>₹ <%= pet.price %></strong></p>
                        <button class="card-button" onclick="window.location.href='/pets'">Buy Now</button>
                    </div>
                <% }); %>
            </div>
        </div>
    </section>
    <hr>
    <section class="feature-prod">
        <div class="feature-pdts-content">
            <h1 class="section-title"><%=featuredProductsTitle%></h1>
            <div class="product-grid">
                <%featuredProducts.forEach(product=> {%>
                        <div class="product-card">
                            <%
                            if (product.images && product.images.length > 0){%>
                                <img src="data:<%=product.images[0].contentType%>;base64,<%=product.images[0].data.toString('base64')%>" alt="<%=product.name%>" class="product-image">    
                            <%}
                            else {%>
                                <p>No images available</p>    
                            <%}
                            %>
                            <p class="price"><strong>₹ <%=product.price%></strong></p>
                            <button class="card-button" onclick="window.location.href='/products'">Buy Now</button>
                        </div>
                    <%})
                %>
            </div>
        </div>
    </section>
    <section id="about" class="about">
        <div class="container">
            <h2 class="section-title">About Petverse</h2>
            <% aboutText.forEach(function(paragraph) { %>
                <p class="about-text"><%- paragraph %></p>
            <% }); %>
            <h3 class="features-title"><%= featuresTitle %></h3>
            <ul class="features-list">
                <% features.forEach(function(feature) { %>
                    <li><span class="point">✔ &nbsp</span><strong> <%= feature.title %>:</strong> <%= feature.description %></li>
                <% }); %>
            </ul>
        </div>
    </section>
    
    <section class="testimonials">
        <div class="testimonial-section">
            <h2><%= testimonialTitle %></h2>
            <div class="testimonial-cards">
                <% testimonials.forEach(function(testimonial) { %>
                    <div class="testimonial">
                        <p>"<%= testimonial.text %>"</p>
                        <span>- <%= testimonial.author %></span>
                    </div>
                <% }); %>
            </div>
        </div>
    </section>
    
    <section class="call-to-action">
        <h2>Ready to Find Your Perfect Pet?</h2>
        <p>Join our community of pet lovers today</p>
        <div class="cta-buttons">
                <button id="adopt" onclick="window.location.href='/pets'" class="cta-btn">Adopt a Pet</button>
                <button id="shop" onclick="window.location.href='/products'" class="cta-btn">Shop Products</button>
        </div>
    </section>
    <footer id="footer">
        <div class="footer-container">
            <div class="footer-logo">
                <h2>PetVerse</h2>
                <p>Your Pet Care Companion</p>
            </div>
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="/home">Home</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/privacy">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-social">
                <h3><%= socialTitle %></h3>
                <% socialLinks.forEach(function(social) { %>
                    <a href="<%= social.url %>" target="_blank" class="social-icon"><%= social.name %></a>
                <% }); %>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <%= new Date().getFullYear() %> <%= siteName %>. All Rights Reserved</p>
        </div>
    </footer>
    <script src="/js/script.js"></script>
    <script src="/js/cart-manager.js"></script>
    <script>
        // Handle user button click based on user role
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize cart count
            if (typeof cartManager !== 'undefined') {
                cartManager.initializeCart();
            } else {
                // Fallback if cart-manager.js is not loaded
                fetch('/cart/count')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const cartCount = document.getElementById('cartCount');
                            if (cartCount) {
                                cartCount.textContent = data.cartCount;
                                cartCount.style.display = data.cartCount > 0 ? 'inline-block' : 'none';
                            }
                        }
                    })
                    .catch(error => console.error('Error fetching cart count:', error));
            }
            
            const userButton = document.getElementById('userButton');
            
            if (userButton) {
                userButton.addEventListener('click', function() {
                    // Check user session status
                    fetch('/check-session')
                        .then(response => response.json())
                        .then(data => {
                            if (data.isLoggedIn) {
                                if (data.isAdmin) {
                                    // Redirect admin to admin dashboard
                                    window.location.href = '/admin/dashboard';
                                } else {
                                    // Redirect non-admin to profile page
                                    window.location.href = '/owner-dashboard';
                                }
                            } else {
                                // Not logged in, redirect to login page
                                window.location.href = '<%= loginUrl %>';
                            }
                        })
                        .catch(error => {
                            console.error('Error checking session:', error);
                            // Default to login page on error
                            window.location.href = '<%= loginUrl %>';
                        });
                });
            }
        });
    </script>
</body>
</html>